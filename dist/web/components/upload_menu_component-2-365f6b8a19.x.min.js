!function(){var n={template:'\n<div class="upload-menu-component">\n  \n  <div class="upload-menu-component-cover"\n    v-show="isShowHandler"\n    @click="hide"\n    v-stop-cover></div>\n\n  <transition name="upload-menu">\n    <div class="upload-menu"\n      v-show="isShowHandler">\n      \x3c!-- <div :class="{handler: true, show: isShowHandler}"\n      v-show="isShowHandler"> --\x3e\n  \n      <div @click.stop="hide">\n        <p>拍照</p>\n        <input type="file"\n          accept="image/*"\n          capture="camera"\n          @change="selectPic"\n          v-if="showFileInput">\n      </div>\n  \n      <i class="horizon-bar"></i>\n  \n      <div @click.stop="hide">\n        <p>从相册中选择</p>\n        <input type="file"\n          accept="image/*"\n          @change="selectPic"\n          v-if="showFileInput">\n      </div>\n      <h4 @touchend.prevent="cancel">取消</h4>\n    </div>\n  </transition>\n</div>\n',props:{token:String},data:function(){return{imgSrc:"",qiNiuToken:"",isShowHandler:!1,showFileInput:!0}},methods:{init:function(){var n=this;this.createdQiNiuScript(function(){n.getQiNiuToken()})},createdQiNiuScript:function(n){var i=document.createElement("script");i.id="qiniu",i.src="https://unpkg.com/qiniu-js@2.1.0/dist/qiniu.min.js",document.head.appendChild(i),n()},getQiNiuToken:function(){var i=this,n={};this.token&&(n.token=this.token),this.$http(API.getQiNiuToken,{},function(n){i.qiNiuToken=n.data.token},function(n){return i.$toast(n.msg)},n)},createUUId:function(){function n(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()+Date.now()},selectPic:function(n){var i=this;this.showFileInput=!1;var t=n.target.files[0],e=t.type;if(-1==e.indexOf("png")&&-1==e.indexOf("jpg")&&-1==e.indexOf("jpeg"))return this.showFileInput=!0,void this.$toast("请上传正确的图片");this.$emit("before-upload",t),this.upload(t),this.$nextTick(function(){i.showFileInput=!0})},upload:function(n){var i=this.qiNiuToken,t=this.createUUId()+".jpg",e={useCdnDomain:!1,region:qiniu.region.z2},o={fname:"",params:{},mimeType:null};console.log("token, key:_____",i,t,e,o);var s=qiniu.upload(n,t,i,o,e);console.log("observable:_____",s),s.subscribe(this.uploading,this.uploadError,this.uploadComplete)},uploadComplete:function(n){console.log("uploadComplete:_____",n);var i=qiniu.imageMogr2({"auto-orient":!0,strip:!0},n.key,"http://test.pic.alasga.cn/");this.imgSrc=i,this.$emit("on-success",i,n)},uploading:function(n){console.log("uploading:_____",n);var i=n.total.percent;this.$emit("input",i)},uploadError:function(n){console.log("err:_____",n),this.$emit("on-error",n)},show:function(){this.isShowHandler=!0},hide:function(){this.isShowHandler=!1},cancel:function(){this.isShowHandler=!1}}};Vue.component("upload-menu-component",n)}();